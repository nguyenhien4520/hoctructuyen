<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý lớp học</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <a class="navbar-brand" href="#">Admin Panel</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/admin">Quay về trang Admin</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container mt-4">
        <h1 class="text-center mb-4">Quản lý lớp học</h1>

        <!-- Các Tab chức năng -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="manage-class-tab" data-bs-toggle="tab"
                    data-bs-target="#manage-class" type="button" role="tab" aria-controls="manage-class"
                    aria-selected="true">Quản lý lớp</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="create-test-tab" data-bs-toggle="tab" data-bs-target="#create-test"
                    type="button" role="tab" aria-controls="create-test" aria-selected="false">Tạo bài kiểm tra</button>
            </li>
        </ul>

        <div class="tab-content" id="myTabContent">

            <!-- Tab Quản lý lớp -->
            <div class="tab-pane fade show active" id="manage-class" role="tabpanel" aria-labelledby="manage-class-tab">
                <div class="mt-4">
                    <h3>Quản lý lớp</h3>
                    <form id="create-class-form" action="/admin/class/create" , method="POST">
                        <div class="mb-3">
                            <label for="newClassName" class="form-label">Tên lớp mới</label>
                            <input type="text" class="form-control" id="newClassName" name="className"
                                placeholder="Nhập tên lớp mới">
                        </div>
                        <div>
                            <label for="teacher" class="form-label">Chọn giáo viên</label>
                            <select class="form-select" name="teacherId" id="teacher">
                                <option value="">Chọn giáo viên</option>
                                {{#each teachers}}
                                <option value="{{this._id}}">{{this.name}}</option>
                                {{/each}}
                            </select>
                        </div>
                        <button type="submit" class="btn btn-success mt-4">Tạo lớp mới</button>
                    </form>

                    <hr>

                    <h4>Danh sách các lớp</h4>
                    <div id="class-list" class="row mt-4">
                        <!-- Danh sách các lớp sẽ được hiển thị ở đây -->
                        {{#each classes}}
                        <div class="col-md-4">
                            <div class="card mb-4">
                                <div class="card-body">
                                    <h5 class="card-title">{{this.name}}</h5>
                                    <p class="card-text"><strong>Giáo viên: </strong>{{this.teacher.name}}</p>
                                    <a href="/admin/class/list-students/{{this._id}}" class="btn btn-primary btn-sm">Xem
                                        học sinh</a>
                                    <a href="/admin/class/list-tests/{{this._id}}" class="btn btn-secondary btn-sm">Bài
                                        kiểm tra</a>
                                    <button class="btn btn-danger btn-sm btn-delete-class" data-id="{{this._id}}">Xóa
                                        lớp</button>
                                </div>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </div>
            </div>

            <!-- Tab Tạo bài kiểm tra -->
            <div class="tab-pane fade" id="create-test" role="tabpanel" aria-labelledby="create-test-tab">
                <div class="mt-4">
                    <h3>Tạo bài kiểm tra</h3>
                    <form id="create-test-form" action="/admin/class/add-test" , method="post">
                        <div class="mb-3">
                            <label for="tesst" class="form-label">Chọn bài kiểm tra</label>
                            <select class="form-select" id="tests" name="test" required>
                                <option value="" selected>Chọn bài kiểm tra</option>
                                {{#each tests}}
                                <option value="{{this._id}}">{{this.title}}</option>
                                {{/each}}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="testClass" class="form-label">Chọn lớp</label>
                            <select class="form-select" id="testClass" name="testClass" required>
                                <option value="" selected>Chọn lớp</option>
                                {{#each classes}}
                                <option value="{{this._id}}">{{this.name}}</option>
                                {{/each}}
                            </select>
                        </div>
                        <div class="mb-3"></div>
                        <label for="testClass" class="form-label">Hiển thị đáp án</label>
                        <select class="form-select" id="showAnswer" name="showAnswer" required>  
                            <option value="true" selected>Có</option>    
                            <option value="false">Không</option>  
                        </select>
                </div>
                <button type="submit" class="btn btn-success mt-4">Thêm</button>
                </form>
            </div>
        </div>
    </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $('.btn-delete-class').on('click', async function (e) {
            const teacherId = $(this).data('id');
            alert("Bạn có chắc chắn muốn xóa");
            try {
                const response = await fetch(`/admin/class/${teacherId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                if (response.ok) {
                    console.log('Class deleted successfully!');
                    window.location.reload(); // Reload the page
                } else {
                    throw new Error('Failed to delete class!');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        });
    </script>
</body>

</html>
